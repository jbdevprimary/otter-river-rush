{
  "$schema": "../pipeline.schema.json",
  "name": "prop",
  "description": "Prop pipeline: text-to-3d-preview â†’ text-to-3d-refine (for textured models)",
  "version": "1.0.0",

  "steps": [
    {
      "id": "preview",
      "task": "text-to-3d-preview",
      "inputs": {
        "prompt": { "source": "manifest", "path": "textTo3DPreviewTask.prompt" },
        "negative_prompt": { "source": "manifest", "path": "textTo3DPreviewTask.negativePrompt", "default": "low quality, blurry, distorted" },
        "art_style": { "source": "manifest", "path": "textTo3DPreviewTask.artStyle", "default": "sculpture" },
        "ai_model": { "value": "meshy-4" },
        "topology": { "source": "manifest", "path": "textTo3DPreviewTask.topology", "default": "quad" },
        "target_polycount": { "source": "manifest", "path": "textTo3DPreviewTask.targetPolycount", "default": 5000 },
        "should_remesh": { "value": true },
        "symmetry_mode": { "source": "manifest", "path": "textTo3DPreviewTask.symmetryMode", "default": "auto" }
      },
      "outputs": {
        "taskId": "$.id",
        "previewModel": "$.model_urls.glb",
        "thumbnail": "$.thumbnail_url"
      }
    },

    {
      "id": "refine",
      "task": "text-to-3d-refine",
      "dependsOn": ["preview"],
      "inputs": {
        "preview_task_id": { "source": "step", "step": "preview", "path": "taskId" },
        "enable_pbr": { "source": "manifest", "path": "textTo3DRefineTask.enablePbr", "default": true },
        "texture_prompt": { "source": "manifest", "path": "textTo3DRefineTask.texturePrompt" }
      },
      "outputs": {
        "taskId": "$.id",
        "model": "$.model_urls.glb",
        "fbx": "$.model_urls.fbx",
        "usdz": "$.model_urls.usdz",
        "thumbnail": "$.thumbnail_url",
        "baseColor": "$.texture_urls[0].base_color",
        "metallic": "$.texture_urls[0].metallic",
        "roughness": "$.texture_urls[0].roughness",
        "normal": "$.texture_urls[0].normal"
      },
      "artifacts": {
        "model.glb": "$.model_urls.glb",
        "thumbnail.png": "$.thumbnail_url"
      }
    }
  ],

  "stateMapping": {
    "text-to-3d-preview": "tasks['text-to-3d-preview']",
    "text-to-3d-refine": "tasks['text-to-3d-refine']"
  }
}
